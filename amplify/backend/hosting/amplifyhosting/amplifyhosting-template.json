{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Branch stack creation for AWS Amplify Console",
    "Parameters": {
        "env": {
            "Type": "String"
        },
        "appId": {
            "Type": "String"
        },
        "type": {
            "Type": "String"
        }
    },
    "Conditions": {
        "isManual": {
            "Fn::Equals": [
                {
                    "Ref": "type"
                },
                "manual"
            ]
        }
    },
    "Resources": {
        "AmplifyBranch": {
            "Condition": "isManual",
            "Type": "AWS::Amplify::Branch",
            "Properties": {
                "AppId": {
                    "Ref": "appId"
                },
                "BranchName": {
                    "Ref": "env"
                },
                "BuildSpec": "version: 1\nbackend:\n  phases:\n    build:\n      commands:\n        - amplifyPush --simple\nfrontend:\n  phases:\n    preBuild:\n      commands:\n        - nvm use 18\n        - npm ci\n    build:\n      commands:\n        - npm run build\n  artifacts:\n    baseDirectory: web-build\n    files:\n      - '**/*'\n  cache:\n    paths:\n      - node_modules/**/*"
            }
        }
    }
}
